var _ = require('underscore');
var ObjectID = require('mongodb').ObjectID;

var FieldBase = function(db, collectionName, attributes)
{
	this.db = db;
	this.collectionName = collectionName;
	this.attr = attributes;
}

FieldBase.prototype = 
{
	get: function(key)
	{
		return this.attributes[key];
	},

	set: function(key, value)
	{
		if(typeof key == Object)
		{
			_.extend(this.attributes, key);
			return this.attributes;
		}

		this.attributes[key] = value;
		return value;
	},

	save: function(callback)
	{
		var root = this;
		this.db.collection(this.collectionName, function(err, collection)
		{
			collection.update 
			(
				{ _id: new ObjectID(rot.attr['_id']) },
				{ $set: root.attr },
				{ safe: true },
				function(err, numOfUpdated)
				{
					callback(err || numOfUpdated);
				}
			);
		});		
	}
}

module.exports = 
{
	create: function(db, collectionName, attr)
	{
		return new FieldBase(db, collectionName, attr);
	}
};